{% extends 'bakery/base.html' %}
{% block title %}–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="card shadow-lg p-4">
    <h2 class="mb-4">üí≥ –û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞ ‚Ññ{{ order.id }}</h2>

    <p><strong>–°—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ:</strong> <span class="text-success">{{ order.total_price }}÷è</span></p>

    <form method="post" id="paymentForm">
      {% csrf_token %}
      <div class="mb-3">
        <label for="card" class="form-label">–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã</label>
        <input type="text" id="card" name="card" maxlength="19"
               class="form-control" placeholder="1234 5678 9012 3456" required>
      </div>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="cvv" class="form-label">CVV</label>
          <input type="text" id="cvv" name="cvv" maxlength="3"
                 class="form-control" placeholder="123" required>
        </div>
        <div class="col-md-6 mb-3">
          <label for="exp" class="form-label">–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è</label>
          <input type="text" id="exp" name="exp" maxlength="5"
                 class="form-control" placeholder="MM/YY" required>
        </div>
      </div>
      <div class="d-flex justify-content-end">
        <button type="submit" class="btn btn-success px-4">–û–ø–ª–∞—Ç–∏—Ç—å ‚úÖ</button>
      </div>
    </form>
  </div>
</div>

<script>
  document.getElementById('card').addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      value = value.replace(/(.{4})/g, '$1 ').trim();
      e.target.value = value;
  });

  document.getElementById('exp').addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length > 2) {
          value = value.slice(0, 2) + '/' + value.slice(2);
      }
      e.target.value = value;
  });

  document.getElementById('paymentForm').addEventListener('submit', function(e) {
      const cvv = document.getElementById('cvv').value;
      const exp = document.getElementById('exp').value;

      if (!/^\d{3}$/.test(cvv)) {
          alert("CVV –¥–æ–ª–∂–µ–Ω —Å–æ—Å—Ç–æ—è—Ç—å —Ä–æ–≤–Ω–æ –∏–∑ 3 —Ü–∏—Ñ—Ä");
          e.preventDefault();
      }

      if (!/^\d{2}\/\d{2}$/.test(exp)) {
          alert("–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ MM/YY");
          e.preventDefault();
      }
  });
</script>
{% endblock %}
