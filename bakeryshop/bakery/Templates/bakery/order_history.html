{% extends 'bakery/base.html' %}
{% block title %}–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2 class="mb-4">üìú –ò—Å—Ç–æ—Ä–∏—è –≤–∞—à–∏—Ö –∑–∞–∫–∞–∑–æ–≤</h2>

  <form method="get" class="mb-4 w-50">
    <select name="status" class="form-select" onchange="this.form.submit()">
      <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
      <option value="–í –ø—Ä–æ—Ü–µ—Å—Å–µ" {% if selected_status == '–í –ø—Ä–æ—Ü–µ—Å—Å–µ' %}selected{% endif %}>–í –ø—Ä–æ—Ü–µ—Å—Å–µ</option>
      <option value="–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã" {% if selected_status == '–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã' %}selected{% endif %}>–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã</option>
      <option value="–û–ø–ª–∞—á–µ–Ω" {% if selected_status == '–û–ø–ª–∞—á–µ–Ω' %}selected{% endif %}>–û–ø–ª–∞—á–µ–Ω</option>
      <option value="–û—Ç–º–µ–Ω—ë–Ω" {% if selected_status == '–û—Ç–º–µ–Ω—ë–Ω' %}selected{% endif %}>–û—Ç–º–µ–Ω—ë–Ω</option>
    </select>
  </form>

  {% if orders %}
    <div class="list-group">
      {% for order in orders %}
      <div class="list-group-item list-group-item-action flex-column align-items-start mb-3 shadow-sm rounded">
        <div class="d-flex w-100 justify-content-between">
          <h5>–ó–∞–∫–∞–∑ ‚Ññ{{ order.id }}</h5>
          <small class="text-muted">{{ order.created_at|date:"d.m.Y H:i" }}</small>
        </div>

        <p><strong>–°—Ç–∞—Ç—É—Å:</strong>
          {% if order.status == '–û–ø–ª–∞—á–µ–Ω' %}
            <span class="badge bg-success">{{ order.status }}</span>
          {% elif order.status == '–í –ø—Ä–æ—Ü–µ—Å—Å–µ' %}
            <span class="badge bg-warning text-dark">{{ order.status }}</span>
          {% elif order.status == '–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã' %}
            <span class="badge bg-secondary">{{ order.status }}</span>
          {% else %}
            <span class="badge bg-dark">{{ order.status }}</span>
          {% endif %}
        </p>

        <p><strong>–°—É–º–º–∞:</strong> {{ order.total_price }}÷è</p>
        <p><strong>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> {{ order.address }}</p>
        <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ order.phone }}</p>

        <div>
          {% if order.status == '–í –ø—Ä–æ—Ü–µ—Å—Å–µ' or order.status == '–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã' %}
            <a href="{% url 'pay_order' order.id %}" class="btn btn-sm btn-success me-2">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–ø–ª–∞—Ç—É</a>
            <a href="{% url 'cancel_unpaid_order' order.id %}" class="btn btn-sm btn-outline-danger me-2"
               onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å —ç—Ç–æ—Ç –∑–∞–∫–∞–∑?')">–û—Ç–º–µ–Ω–∏—Ç—å</a>
          {% elif order.status == '–û–ø–ª–∞—á–µ–Ω' %}
            <a href="{% url 'request_refund' order.id %}" class="btn btn-sm btn-outline-warning me-2"
               onclick="return confirm('–ó–∞–ø—Ä–æ—Å–∏—Ç—å –≤–æ–∑–≤—Ä–∞—Ç –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–∫–∞–∑–∞?')">–ó–∞–ø—Ä–æ—Å–∏—Ç—å –≤–æ–∑–≤—Ä–∞—Ç</a>
          {% else %}
            <button class="btn btn-sm btn-secondary" disabled>–î–µ–π—Å—Ç–≤–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</button>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="lead text-muted">–í—ã –µ—â—ë –Ω–µ —Å–¥–µ–ª–∞–ª–∏ –Ω–∏ –æ–¥–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞.</p>
  {% endif %}
</div>
{% endblock %}
