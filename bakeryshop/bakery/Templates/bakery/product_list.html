{% extends 'bakery/base.html' %}
{% load static %}

{% block title %}–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/product-card.css' %}">
{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2 class="mb-4">–ù–∞—à–∏ —Ç–æ–≤–∞—Ä—ã</h2>

  <form method="get" class="row mb-4">
    <div class="col-md-6">
      <label for="category" class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
      <select name="category" id="category" class="form-select" onchange="this.form.submit()">
        <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
        {% for cat in categories %}
          <option value="{{ cat.slug }}" {% if selected_category == cat.slug %}selected{% endif %}>{{ cat.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-6">
      <label for="sort" class="form-label">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</label>
      <select name="sort" class="form-select" onchange="this.form.submit()">
        <option value="">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ...</option>
        <option value="price_asc" {% if sort == 'price_asc' %}selected{% endif %}>üí∞ –¶–µ–Ω–∞: –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
        <option value="price_desc" {% if sort == 'price_desc' %}selected{% endif %}>üí∏ –¶–µ–Ω–∞: –ø–æ —É–±—ã–≤–∞–Ω–∏—é</option>
        <option value="popularity" {% if sort == 'popularity' %}selected{% endif %}>üî• –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å</option>
        <option value="rating" {% if sort == 'rating' %}selected{% endif %}>‚≠êÔ∏è –†–µ–π—Ç–∏–Ω–≥</option>
        <option value="newest" {% if sort == 'newest' %}selected{% endif %}>üÜï –ù–æ–≤–∏–Ω–∫–∏</option>
      </select>
    </div>
  </form>

  {% if products %}
    <div class="row row-cols-2 row-cols-md-4 g-4">
      {% for product in products %}
        <div class="col">
          <div class="card product-card h-100 text-center border-0 shadow-sm">
            <a href="{% url 'product_detail' product.pk %}" class="text-decoration-none text-dark">
              <div class="product-image-wrapper mx-auto mt-3">
                <img src="{{ product.image.url }}" class="img-fluid rounded" alt="{{ product.name }}">
              </div>
              <div class="card-body p-2">
                <h6 class="card-title mb-1">{{ product.name }}</h6>
                <p class="text-muted mb-0">{{ product.price }}÷è</p>
              </div>
            </a>
            <form method="post" action="{% url 'add_to_cart' product.id %}" class="mb-3">
              {% csrf_token %}
              <input type="hidden" name="quantity" value="1" />
              <button type="submit" class="btn btn-outline-primary custom-add-btn">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
            </form>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p>–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤.</p>
  {% endif %}
</div>
{% endblock %}
